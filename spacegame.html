<!DOCTYPE html>
<html>
  <head>
    <title>Space Radar Game</title>
    <style>
      canvas {
        border: 1px solid white;
        background: black;
      }
      body {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        margin: 0;
        background: #111;
      }
      #upgrades {
        position: absolute;
        top: 10px;
        right: 10px;
        color: white;
      }
    </style>
  </head>
  <body>
    <canvas id="gameCanvas" width="800" height="600"></canvas>
    <div id="upgrades">
      <button onclick="upgradeRadar()">Upgrade Radar (50)</button>
      <button onclick="upgradeFighters()">Upgrade Fighters (50)</button>
      <button onclick="upgradeMiners()">Upgrade Miners (50)</button>
    </div>

    <script>
      const canvas = document.getElementById("gameCanvas");
      const ctx = canvas.getContext("2d");

      // Game objects
      class GameObject {
        constructor(x, y, size, color) {
          this.x = x;
          this.y = y;
          this.size = size;
          this.color = color;
        }

        draw() {
          ctx.fillStyle = this.color;
          ctx.beginPath();
          ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
          ctx.fill();
        }

        inRadarRange() {
          const dx = this.x - capitalShip.x;
          const dy = this.y - capitalShip.y;
          return Math.sqrt(dx * dx + dy * dy) <= capitalShip.radarRange;
        }
      }

      class CapitalShip extends GameObject {
        constructor(x, y) {
          super(x, y, 20, "cyan");
          this.resources = 100;
          this.fighterCount = 0;
          this.minerCount = 0;
          this.radarRange = 200;
          this.speed = 3;
        }

        manufacture(type) {
          if (this.resources >= 20) {
            this.resources -= 20;
            if (type === "fighter") this.fighterCount++;
            else if (type === "miner") this.minerCount++;
          }
        }

        move(dx, dy) {
          this.x = Math.max(20, Math.min(canvas.width - 20, this.x + dx));
          this.y = Math.max(20, Math.min(canvas.height - 20, this.y + dy));
        }
      }

      class Fighter extends GameObject {
        constructor(x, y) {
          super(x, y, 5, "green");
          this.target = null;
          this.power = 1;
        }

        update(enemies) {
          if (!this.inRadarRange()) return;

          if (this.target && this.target.health > 0) {
            const dx = this.target.x - this.x;
            const dy = this.target.y - this.y;
            const distance = Math.sqrt(dx * dx + dy * dy);
            if (distance > 5) {
              this.x += (dx / distance) * 2;
              this.y += (dy / distance) * 2;
            } else {
              this.target.health -= this.power;
            }
          } else {
            this.target = enemies.find((e) => e.health > 0 && e.inRadarRange());
            if (!this.target) {
              const dx = capitalShip.x - this.x;
              const dy = capitalShip.y - this.y;
              const distance = Math.sqrt(dx * dx + dy * dy);
              if (distance > 20) {
                this.x += (dx / distance) * 2;
                this.y += (dy / distance) * 2;
              }
            }
          }
        }
      }

      class Miner extends GameObject {
        constructor(x, y) {
          super(x, y, 5, "yellow");
          this.target = null;
          this.carrying = 0;
          this.speed = 2;
        }

        update(asteroids) {
          if (!this.inRadarRange()) return;

          if (this.carrying > 0) {
            const dx = capitalShip.x - this.x;
            const dy = capitalShip.y - this.y;
            const distance = Math.sqrt(dx * dx + dy * dy);
            if (distance > 20) {
              this.x += (dx / distance) * this.speed;
              this.y += (dy / distance) * this.speed;
            } else {
              capitalShip.resources += this.carrying;
              this.carrying = 0;
            }
          } else {
            if (!this.target || this.target.resources <= 0) {
              this.target = asteroids.find(
                (a) => a.resources > 0 && a.inRadarRange()
              );
            }
            if (this.target) {
              const dx = this.target.x - this.x;
              const dy = this.target.y - this.y;
              const distance = Math.sqrt(dx * dx + dy * dy);
              if (distance > 5) {
                this.x += (dx / distance) * this.speed;
                this.y += (dy / distance) * this.speed;
              } else {
                if (this.target.resources > 0) {
                  this.target.resources--;
                  this.carrying++;
                }
              }
            }
          }
        }
      }

      class Asteroid extends GameObject {
        constructor(x, y) {
          super(x, y, 10, "gray");
          this.resources = 50;
        }
      }

      class Enemy extends GameObject {
        constructor(x, y) {
          super(x, y, 8, "red");
          this.health = 10;
        }

        update() {
          const dx = capitalShip.x - this.x;
          const dy = capitalShip.y - this.y;
          const distance = Math.sqrt(dx * dx + dy * dy);
          if (distance > 20) {
            this.x += (dx / distance) * 1.5;
            this.y += (dy / distance) * 1.5;
          }
        }
      }

      // Game initialization
      const capitalShip = new CapitalShip(canvas.width / 2, canvas.height / 2);
      let fighters = [];
      let miners = [];
      let asteroids = [];
      let enemies = [];

      // Controls
      const keys = {};
      document.addEventListener("keydown", (e) => (keys[e.key] = true));
      document.addEventListener("keyup", (e) => (keys[e.key] = false));

      // Upgrades
      function upgradeRadar() {
        if (capitalShip.resources >= 50) {
          capitalShip.resources -= 50;
          capitalShip.radarRange += 50;
        }
      }

      function upgradeFighters() {
        if (capitalShip.resources >= 50) {
          capitalShip.resources -= 50;
          fighters.forEach((f) => (f.power += 0.5));
        }
      }

      function upgradeMiners() {
        if (capitalShip.resources >= 50) {
          capitalShip.resources -= 50;
          miners.forEach((m) => (m.speed += 0.5));
        }
      }

      // Spawn initial asteroids
      for (let i = 0; i < 5; i++) {
        asteroids.push(
          new Asteroid(
            Math.random() * canvas.width,
            Math.random() * canvas.height
          )
        );
      }

      // Game loop
      function gameLoop() {
        ctx.fillStyle = "rgba(0, 0, 0, 0.1)";
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // Handle movement
        if (keys["ArrowUp"] || keys["w"])
          capitalShip.move(0, -capitalShip.speed);
        if (keys["ArrowDown"] || keys["s"])
          capitalShip.move(0, capitalShip.speed);
        if (keys["ArrowLeft"] || keys["a"])
          capitalShip.move(-capitalShip.speed, 0);
        if (keys["ArrowRight"] || keys["d"])
          capitalShip.move(capitalShip.speed, 0);

        capitalShip.draw();
        if (Math.random() < 0.05 && capitalShip.fighterCount < 10)
          capitalShip.manufacture("fighter");
        if (Math.random() < 0.05 && capitalShip.minerCount < 5)
          capitalShip.manufacture("miner");

        // Manage fighters
        if (fighters.length < capitalShip.fighterCount) {
          fighters.push(new Fighter(capitalShip.x, capitalShip.y));
        }
        fighters.forEach((f) => {
          f.update(enemies);
          f.draw();
        });

        // Manage miners
        if (miners.length < capitalShip.minerCount) {
          miners.push(new Miner(capitalShip.x, capitalShip.y));
        }
        miners.forEach((m) => {
          m.update(asteroids);
          m.draw();
        });

        // Update and draw asteroids
        asteroids.forEach((a) => a.draw());
        if (Math.random() < 0.02 && asteroids.length < 10) {
          asteroids.push(
            new Asteroid(
              Math.random() * canvas.width,
              Math.random() * canvas.height
            )
          );
        }

        // Manage enemies
        if (Math.random() < 0.01 && enemies.length < 5) {
          enemies.push(
            new Enemy(
              Math.random() > 0.5 ? 0 : canvas.width,
              Math.random() * canvas.height
            )
          );
        }
        enemies = enemies.filter((e) => e.health > 0);
        enemies.forEach((e) => {
          e.update();
          e.draw();
        });

        // Draw radar
        ctx.strokeStyle = "rgba(0, 255, 0, 0.3)";
        ctx.beginPath();
        ctx.arc(
          capitalShip.x,
          capitalShip.y,
          capitalShip.radarRange,
          0,
          Math.PI * 2
        );
        ctx.stroke();

        // Draw info
        ctx.fillStyle = "white";
        ctx.font = "16px Arial";
        ctx.fillText(`Resources: ${capitalShip.resources}`, 10, 20);
        ctx.fillText(
          `Fighters: ${fighters.length} (Power: ${fighters[0]?.power || 1})`,
          10,
          40
        );
        ctx.fillText(
          `Miners: ${miners.length} (Speed: ${miners[0]?.speed || 2})`,
          10,
          60
        );
        ctx.fillText(`Radar Range: ${capitalShip.radarRange}`, 10, 80);

        requestAnimationFrame(gameLoop);
      }

      gameLoop();
    </script>
  </body>
</html>
